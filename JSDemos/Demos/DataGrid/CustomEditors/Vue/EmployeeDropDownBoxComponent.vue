<template>
  <DxDropDownBox
    :ref="dropDownBoxRef"
    :drop-down-options="dropDownOptions"
    :input-attr="{ 'aria-label': 'Owner' }"
    :data-source="dataSource"
    v-model:value="currentValue"
    display-expr="FullName"
    value-expr="ID"
    content-template="contentTemplate"
  >
    <template #contentTemplate="{}">
      <DxDataGrid
        :data-source="dataSource"
        :remote-operations="true"
        :height="250"
        :selected-row-keys="[currentValue]"
        :hover-state-enabled="true"
        :on-selection-changed="onSelectionChanged"
        :focused-row-enabled="true"
        :focused-row-key="currentValue"
        key-expr="ID"
      >
        <DxColumn data-field="FullName"/>
        <DxColumn data-field="Title"/>
        <DxColumn data-field="Department"/>
        <DxPaging
          :enabled="true"
          :page-size="10"
        />
        <DxScrolling mode="virtual"/>
        <DxSelection mode="single"/>
      </DxDataGrid>
    </template>
  </DxDropDownBox>
</template>
<script setup lang="ts">
import { ref } from 'vue';
import {
  DxDataGrid,
  DxPaging,
  DxSelection,
  DxScrolling,
  DxColumn,
} from 'devextreme-vue/data-grid';
import DxDropDownBox from 'devextreme-vue/drop-down-box';

const props = withDefaults(defineProps<{
  value?: number
  onValueChanged?: Function
  dataSource?: object
}>(), {
  value: null,
  onValueChanged: () => function() {},
  dataSource: () => {},
});

const currentValue = ref(props.value);
const dropDownBoxRef = ref(null);
const dropDownOptions = { width: 500 };

function onSelectionChanged(selectionChangedArgs) {
  currentValue.value = selectionChangedArgs.selectedRowKeys[0];
  props.onValueChanged(currentValue.value);
  if (selectionChangedArgs.selectedRowKeys.length > 0) {
    dropDownBoxRef.value?.instance.close();
  }
}
</script>
